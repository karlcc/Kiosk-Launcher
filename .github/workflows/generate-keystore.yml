name: Generate Release Keystore

on:
  workflow_dispatch:  # Manual trigger only - run this ONCE per repository

jobs:
  generate-keystore:
    runs-on: ubuntu-latest
    
    steps:
      - name: Generate Release Keystore
        run: |
          echo "🔐 Generating release keystore for APK signing..."
          keytool -genkey -v \
            -keystore release-key.keystore \
            -keyalg RSA \
            -keysize 2048 \
            -validity 10000 \
            -alias release \
            -dname "CN=Kiosk Launcher, OU=Development, O=KioskLauncher, L=Unknown, S=Unknown, C=US" \
            -storepass "KioskLauncher2025!" \
            -keypass "KioskLauncher2025!"
          echo "✅ Keystore generated successfully"
      
      - name: Convert Keystore to Base64
        run: |
          base64 release-key.keystore > keystore-base64.txt
          echo "✅ Keystore converted to base64 for GitHub secrets"
          echo "📊 Content length: $(wc -c < keystore-base64.txt) characters"
          
      - name: Upload Keystore Files
        uses: actions/upload-artifact@v4
        with:
          name: release-keystore
          path: |
            release-key.keystore
            keystore-base64.txt
            
      - name: Next Steps
        run: |
          echo "🎯 NEXT STEPS:"
          echo "1. Download the 'release-keystore' artifact from this workflow run"
          echo "2. Extract keystore-base64.txt from the download"
          echo "3. Copy the base64 content and add these GitHub secrets:"
          echo "   • KEYSTORE_BASE64 = [content of keystore-base64.txt]"
          echo "   • KEYSTORE_PASSWORD = KioskLauncher2025!"
          echo "   • KEY_ALIAS = release"  
          echo "   • KEY_PASSWORD = KioskLauncher2025!"
          echo "4. Run the 'Build Kiosk Launcher Release APK' workflow"
          echo "5. Download your signed, installable APK! 🚀"